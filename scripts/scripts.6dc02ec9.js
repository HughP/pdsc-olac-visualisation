"use strict";angular.module("appApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngMaterial","underscore","leaflet"]).config(["$routeProvider","$logProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/analyse",{templateUrl:"views/analyse.html",controller:"AnalyseCtrl",controllerAs:"analyse"}).otherwise({redirectTo:"/"}),b.debugEnabled(!1)}]),angular.module("appApp").controller("MainCtrl",["$scope","$http","$mdSidenav","$mdDialog","_","dataService","$timeout",function(a,b,c,d,e,f,g){a.dataLoaded=!1,a.datasets={languages:void 0,countries:void 0,regions:void 0},e.isNull(f.datasets.languages)||e.isNull(f.datasets.countries)?f.init().then(function(){a.datasets=f.datasets,a.dataLoaded=!0}):(a.datasets=f.datasets,a.dataLoaded=!0),a.toggleSideNav=function(){c("right").toggle()},a.reset=function(){f.reset()}}]),angular.module("appApp").controller("AnalyseCtrl",["$scope","dataService","_",function(a,b,c){b.reset(),a.reset=function(){a.data={x:[],y:[],limit:50}},a.processData=function(){a.reset(),a.byCount=c.groupBy(b.datasets.filtered.languages,"count"),c.each(a.byCount,function(b,c){a.data.x.push(c),a.data.y.push(b.length)}),a.data.xTotal=a.data.x.length,a.dataLoaded=!0},c.isNull(b.datasets.languages)||c.isNull(b.datasets.countries)?b.init().then(function(){a.processData()}):a.processData(),a.$on("dataset filtered",function(){a.processData()},!0)}]),angular.module("appApp").directive("markerLegend",["configuration",function(a){return{templateUrl:"views/marker-legend.html",restrict:"E",scope:{},link:function(b){b.colours=a.markerColours}}}]),angular.module("appApp").directive("browse",["$http","$mdSidenav","configuration","$rootScope","_","dataService",function(a,b,c,d,e,f){return{templateUrl:"views/browse.html",restrict:"E",scope:{countries:"=",languages:"=",isVisible:"="},link:function(b){b.$watch("countries",function(){b.browseCountries()},!0),b.$watch("isVisible",function(){b.isVisible?c.selectedLanguage?b.show("language",{code:c.selectedLanguage}):b.browseCountries():(delete c.selectedLanguage,delete b.languageData,delete b.country,delete b.items)}),b.show=function(g,h){"country"===g?(b.country=h.name,b.title="Browse languages in "+b.country,b.items={list:e.compact(e.map(h.language_data,function(a){return f.datasets.languageByCode[a.code]})),what:"language"},b.error=!1):"language"===g&&a.get("data/"+h.code+".json").then(function(a){b.title="",b.languageData=a.data,c.latlng={code:b.languageData.code,lat:b.languageData.coords[0],lng:b.languageData.coords[1]},d.$broadcast("zoom-to"),b.error=!1},function(){delete b.items,delete b.languageData,b.error=!0})},b.browseCountries=function(){b.country=null,delete b.languageData,b.title="Browse countries",b.items={list:e.sortBy(b.countries,function(a){return a.name}),what:"country"}},b.browseLanguages=function(){b.title="Browse languages in "+b.country,delete b.languageData},b.back=function(){b.languageData?b.browseLanguages():b.country&&b.browseCountries()}}}}]),angular.module("appApp").directive("controls",["dataService","$timeout","_",function(a,b,c){return{templateUrl:"views/controls.html",restrict:"E",scope:{},link:function(d){d.resourceTypes=a.datasets.resourceTypes,d.countries=c.sortBy(a.datasets.filtered.countries,"name"),d.$on("dataset filtered",function(){d.countries=c.sortBy(a.datasets.filtered.countries,"name")},!0),d.filterByResource=function(c){b(function(){a.filterByResource(c)},200)},d.filterByCountry=function(c){b(function(){a.filterByCountry(c)},200)}}}}]),angular.module("underscore",[]).factory("_",function(){return window._}),angular.module("leaflet",[]).factory("leaflet",function(){return window.L}),angular.module("appApp").directive("leaflet",["leaflet","_","configuration","$compile","$mdDialog","$window","$mdSidenav","$timeout",function(a,b,c,d,e,f,g,h){return{templateUrl:"views/leaflet.html",restrict:"E",scope:{languages:"="},link:function(e){e.showLoadingIndicator=!0,e.compiledPopups={},e.$on("zoom-to",function(){c.latlng.lat&&c.latlng.lng&&(e.map.panTo(a.latLng(parseFloat(c.latlng.lat),parseFloat(c.latlng.lng))),e.map.setZoom(8),e.markersByCode[c.latlng.code].openPopup()),delete c.latlng}),e.$watch("languages",function(){e.markers&&e.markerList&&e.markers.removeLayers(e.markerList),h(function(){e.drawMarkers()},1e3)}),angular.element(document.getElementById("map"))[0].style.height=.7*f.innerHeight+"px",e.map=a.map("map",{minZoom:1}).setView([0,0],2),a.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',noWrap:!0}).addTo(e.map),e.updateProgressBar=function(a,b){e.$apply(function(){e.progress=Math.round(a/b*100),a===b&&h(function(){e.showLoadingIndicator=!1},500)})},e.markers=a.markerClusterGroup({chunkedLoading:!0,chunkInterval:50,chunkDelay:50,chunkProgress:e.updateProgressBar}),e.drawMarkers=function(){e.markersByCode={},e.markerList=b.compact(b.map(e.languages,function(f){if(parseFloat(f.coords[0])&&parseFloat(f.coords[1])){var g=0;b.each(f.resources,function(a){g+=a});var h;h=20>g?c.markerColours[0].colour:150>g?c.markerColours[1].colour:c.markerColours[2].colour;var i=a.marker(new a.LatLng(parseFloat(f.coords[0]),parseFloat(f.coords[1])),{clickable:!0,icon:a.MakiMarkers.icon({icon:"marker",color:h,size:"l"})});if(e.markersByCode[f.code]=i,!e.compiledPopups[f.name]){var j=d("<span><h4>"+f.name+"<br/> ("+g+" resources)</h4><br/><a href='' ng-click='moreInfo(\""+f.code+"\")'>more information</a></span>")(e);e.compiledPopups[f.name]=j[0]}return i.bindPopup(e.compiledPopups[f.name]),i.bindLabel(f.name,{noHide:!0,direction:"auto"}),i}})),e.markers.addLayers(e.markerList),e.map.addLayer(e.markers),h(function(){var a=new L.featureGroup(e.markerList);e.map.fitBounds(a.getBounds())},2500)},e.moreInfo=function(a){c.selectedLanguage=a,g("right").toggle()}}}}]),angular.module("appApp").constant("configuration",{languageArchives:"http://www.language-archives.org",map:{width:"100%",height:.95*window.innerHeight},markerColours:[{colour:"#ea1540",label:"less than 20 resources"},{colour:"#ff8c00",label:"between 20 and 150 resources"},{colour:"#2eb82e",label:"more than 150 resources"}]}),angular.module("appApp").directive("resourceRenderer",["$timeout","$rootScope","configuration","$mdDialog",function(a,b,c,d){return{templateUrl:"views/resource-renderer.html",restrict:"E",scope:{title:"@",resources:"="},link:function(c){c.config={pageSize:10,start:0,numberFrom:1,hide:!0,enablePagination:!1,me:!1},c.$on("close-item",function(){c.config.me||(c.config.hide=!0),c.config.me=!1}),c.$watch("searchResults",function(){c.searchResults&&(c.resources=c.searchResults),c.updateSet()},!0),c.resources.length>c.config.pageSize?(c.resourceSet=c.resources.slice(0,c.config.pageSize),c.enablePagination=!0):c.resourceSet=c.resources,c.updateSet=function(){c.config.numberFrom=c.config.start+1,c.resourceSet=c.resources.slice(c.config.start,c.config.start+c.config.pageSize)},c.jumpToStart=function(){c.config.start=0,c.updateSet()},c.back=function(){c.config.start-=c.config.pageSize,c.config.start<0&&(c.config.start=0),c.updateSet()},c.forward=function(){c.config.start<c.resources.length-c.config.pageSize&&(c.config.start+=c.config.pageSize),c.updateSet()},c.jumpToEnd=function(){c.config.start=c.resources.length-c.config.pageSize,c.updateSet()},c.toggleItem=function(){c.config.me=!0,b.$broadcast("close-item"),a(function(){c.config.hide=!c.config.hide},10)},c.moreInformation=function(a){d.show({controller:function(){},template:'<md-dialog>    <md-dialog-content><iframe src="'+a+'" class="item-information-dialog"/></md-dialog-content></md-dialog>',parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:!0})},c.close=function(){console.log("close the dialog")}}}}]),angular.module("appApp").directive("searchResources",["_",function(a){return{templateUrl:"views/search-resources.html",restrict:"E",scope:{resources:"=",searchResults:"="},link:function(b){b.originalResources=b.resources,b.search=function(){b.what.length<3?b.searchResults=b.originalResources:b.what.length>2&&(b.searchResults=a.compact(a.map(b.originalResources,function(a){var c=new RegExp(b.what,"im"),d=a.text.search(c);return-1!==d?a:void 0})))},b.reset=function(){delete b.what,b.searchResults=b.originalResources}}}}]),angular.module("appApp").directive("plotlyBarChart",["dataService","_",function(a,b){return{template:"<div></div>",restrict:"E",scope:{data:"="},link:function(a,b){a.layout={title:"Languages vs resource count",height:300,xaxis:{title:"Number of resources"},yaxis:{title:"Number of languages"}},a.graphIt=function(){a.d=[{x:a.data.x.slice(0,a.data.limit),y:a.data.y.slice(0,a.data.limit),type:"bar"}],Plotly.newPlot(b[0],a.d,a.layout)},a.$watch("data",function(){a.graphIt()},!0),a.graphIt()}}}]),angular.module("appApp").service("dataService",["$http","_","configuration","$rootScope",function(a,b,c,d){var e={};return e.datasets={languages:null,countries:null},e.datasets.filtered={},e.resourceFilters=[],e.countryFilter=[],e.reset=function(){e.datasets.filtered.languages=angular.copy(e.datasets.languages),e.datasets.filtered.countries=angular.copy(e.datasets.countries)},e.init=function(){return b.isNull(e.datasets.languages)||b.isNull(e.datasets.countries)?e.get("languages").then(function(a){return e.datasets.languages=a,e.get("countries")}).then(function(a){e.datasets.countries=a,e.languageResourceCounts(),e.mapLanguagesToCountries(),e.countryByName(),e.languageByCode(),e.extractResourceTypes(),console.log(e.datasets)}):void 0},e.get=function(c){var d;switch(c){case"languages":d="data/index.json";break;case"regions":d="data/regions.json";break;case"countries":d="data/countries.json"}return a.get(d).then(function(a){var d=b.compact(b.map(a.data,function(a){try{return a}catch(b){}}));return void 0!==e.slice?(e.datasets[c]=d.slice(0,e.slice),e.datasets.filtered[c]=d.slice(0,e.slice)):(e.datasets[c]=d,e.datasets.filtered[c]=d),e.datasets[c]})},e.mapLanguagesToCountries=function(){e.datasets.languageToCountryMapping={},b.each(e.datasets.countries,function(a){b.each(a.language_data,function(b){try{e.datasets.languageToCountryMapping[b.code].push(a.name)}catch(c){e.datasets.languageToCountryMapping[b.code]=[a.name]}})})},e.countryByName=function(){e.datasets.countryByName={},b.each(e.datasets.countries,function(a){e.datasets.countryByName[a.name]=a})},e.languageByCode=function(){e.datasets.languageByCode={},b.each(e.datasets.languages,function(a){e.datasets.languageByCode[a.code]=a})},e.languageResourceCounts=function(){b.each(e.datasets.languages,function(a){a.count=0,b.each(a.resources,function(b){a.count+=b}),a.colour=e.languageColour(a)})},e.languageColour=function(a){return a.count<20?c.markerColours[0].colour:a.count>20&&a.count<150?c.markerColours[1].colour:c.markerColours[2].colour},e.extractResourceTypes=function(){var a=b.map(e.datasets.languages,function(a){return b.keys(a.resources)});e.datasets.resourceTypes=b.uniq(b.flatten(a)).sort()},e.filterByResource=function(a){b.contains(e.resourceFilters,a)?e.resourceFilters=b.without(e.resourceFilters,a):e.resourceFilters.push(a);var c,f,g;if(b.isEmpty(e.resourceFilters))c=e.datasets.languages,f=e.datasets.countries;else{c=b.compact(b.map(e.datasets.languages,function(a){return b.isEmpty(b.intersection(b.keys(a.resources),e.resourceFilters))?void 0:a}));var h=b.keys(b.groupBy(c,"code"));f=[],g=[],b.each(c,function(a){var b=e.datasets.languageToCountryMapping[a.code];if(b){var c=e.datasets.countryByName[b[0]];-1===g.indexOf(c.name)&&(f.push(c),g.push(c.name))}}),b.each(f,function(a){var c=b.map(a.language_data,function(a){return-1!==h.indexOf(a.code)?a:void 0});a.language_data=b.compact(c)})}e.datasets.filtered.languages=c,e.datasets.filtered.countries=f,d.$broadcast("dataset filtered")},e.filterByCountry=function(a){b.contains(e.countryFilter,a)?e.countryFilter=b.without(e.countryFilter,a):e.countryFilter.push(a);var c,f;b.isEmpty(e.countryFilter)?(c=e.datasets.languages,f=e.datasets.countries):(f=[a],c=b.compact(b.map(e.datasets.languages,function(b){try{if(-1!==e.datasets.languageToCountryMapping[b.code].indexOf(a.name))return b}catch(c){}}))),e.datasets.filtered.languages=c,e.datasets.filtered.countries=f,d.$broadcast("dataset filtered")},e}]),angular.module("appApp").run(["$templateCache",function(a){a.put("views/analyse.html",'<div layout="column" layout-padding ng-if="dataLoaded"> <div layout="row" layout-align="center center"> <div> <plotly-bar-chart data="data"></plotly-bar-chart> <md-slider flex min="0" max="{{data.xTotal}}" ng-model="data.limit" aria-label="graph limit"></md-slider> <div class="md-caption">Use the slider to change the number of resources to display.</div> </div> </div> <md-divider></md-divider> <div layout="row" layout-align="center center"> <controls></controls> </div> </div>'),a.put("views/browse.html",'<div layout="column" layout-padding> <div layout="row"> <div class="md-subhead">{{title}}</div> <div flex></div> <md-button class="md-primary" ng-click="back()" ng-if="country">back</md-button> </div> <md-divider></md-divider> </div> <!-- list of countries / languages --> <md-content ng-if="!languageData"> <md-list> <md-list-item ng-click="show(items.what, item)" ng-repeat="item in items.list track by $index" aria-label="country list"> <div layout="row" flex> <span ng-if="!item.language_data" flex="10"> <div style="background-color: {{item.colour}}; margin: 8px; height:25px; width: 25px; border-radius: 12px"></div> </span> <span flex="90"> {{item.name}} <span ng-if="item.language_data">&nbsp;({{item.language_data.length}} languages)</span> <span ng-if="!item.language_data && item.count">&nbsp;({{item.count}} resources)</span> </span> </div> </md-list-item> </md-list> </md-content> <md-content ng-if="languageData"> <h4 class="md-title"><span ng-if="country">{{country}}:</span> {{languageData.name}}</h4> <p> <a href="{{languageData.url}}" target="_blank">{{languageData.url}}</a> </p> <md-list> <span ng-if="languageData.resources[\'Primary texts\']"> <resource-renderer title="Primary Texts" resources="languageData.resources[\'Primary texts\'].resources"></resource-renderer> </span> <span ng-if="languageData.resources[\'Lexical resources\']"> <resource-renderer title="Lexical Resources" resources="languageData.resources[\'Lexical resources\'].resources"></resource-renderer> </span> <span ng-if="languageData.resources[\'Language descriptions\']"> <resource-renderer title="Language Descriptions" resources="languageData.resources[\'Language descriptions\'].resources"></resource-renderer> </span> <span ng-if="languageData.resources[\'Other resources about the language\']"> <resource-renderer title="Other resources about the language" resources="languageData.resources[\'Other resources about the language\'].resources"></resource-renderer> </span> <span ng-if="languageData.resources[\'Other resources in the language\']"> <resource-renderer title="Other resources in the language" resources="languageData.resources[\'Other resources in the language\'].resources"></resource-renderer> </span> </md-list> </md-content> <md-content ng-if="error" layout="column" layout-align="center center"> <img src="images/error.6d052d18.svg"> Whatever your language and however you say it it doesn\'t change the fact that something went wrong! </md-content>'),a.put("views/controls.html",'<div layout="row" layout-padding> <div layout="column" layout-padding> <div class="md-subhead">Filter languages with the following resources</div> <md-divider></md-divider> <div> <div ng-repeat="resource in resourceTypes"> <md-checkbox ng-click="filterByResource(resource)"> {{resource}} </md-checkbox> </div> </div> </div> <div layout="column" layout-padding> <div class="md-subhead">Filter languages by country</div> <md-divider></md-divider> <div style="position: relative; height: 300px; overflow: scroll"> <div ng-repeat="country in countries"> <md-checkbox ng-click="filterByCountry(country)"> {{country.name}} </md-checkbox> </div> </div> </div> <div> <a href="/#/" class="md-button md-primary">View on map</a> </div> </div>'),a.put("views/leaflet.html",'<md-progress-linear md-mode="determinate" value="{{progress}}" ng-if="showLoadingIndicator"></md-progress-linear> <div id="map"></div>'),a.put("views/main.html",'<div ng-if="dataLoaded"> <md-content> <md-card> <md-card-content> <leaflet languages="datasets.filtered.languages"></leaflet> </md-card-content> </md-card> <div layout="row" layout-padding> <marker-legend class="marker-legend" ng-if="datasets.filtered.languages"></marker-legend> <div class="" flex="40"> <div layout="column"> <div> <a href="http://www.dynamicsoflanguage.edu.au/"> <img src="http://www.dynamicsoflanguage.edu.au/design/main/images/logo-2x.png" style="width: 70%"> </a> </div> <div class="md-caption"> This work was done by <a href="https://github.com/MLR-au" target="_blank">Marco La Rosa</a> in a project led by <a href="http://languages-linguistics.unimelb.edu.au/about/staff/dr-nick-thieberger" target="_blank">Nick Thieberger</a> at the University of Melbourne as part of <a href="http://www.dynamicsoflanguage.edu.au/" target="_blank"> Centre of Excellence for the Dynamics of Language </a> (ARC grant CE140100041). </div> </div> </div> <div class="help-text" flex="50"> This map shows the number of items available in archives participating in the <a href="http://www.language-archives.org/" target="_blank">Open Language Archives Community</a> for any given language. The main aim of these archives is to make available information about the smaller languages of the world. Clearly, major languages have enormous amounts of information available, but for many of the world\'s languages, as will be seen on this site, little or nothing has been recorded or is available via one of the participating archives. </div> </div> </md-content> <md-fab-speed-dial class="md-fab-bottom-right" style="z-index: 10000"> <md-fab-trigger> <md-button aria-label="menu" class="md-fab md-warn" ng-click="toggleSideNav()"> <i class="material-icons md-48">add</i> </md-button> </md-fab-trigger> </md-fab-speed-dial> <md-sidenav class="md-sidenav-right md-whiteframe-z2" md-component-id="right" style="z-index: 10000" md-is-open="config.controlsOpen"> <md-content> <md-toolbar layout="row" class="md-padding"> <a href="/#/analyse" class="md-button md-primary">Data Analysis</a> <div flex></div> <md-button class="md-primary" ng-click="reset()">reset</md-button> <md-button class="md-primary" ng-click="toggleSideNav()">close</md-button> </md-toolbar> <div layout="column" layout-padding> <browse countries="datasets.filtered.countries" languages="datasets.filtered.languages" is-visible="config.controlsOpen"></browse> </div> </md-content> </md-sidenav> </div>'),a.put("views/marker-legend.html",'<div layout="column" class="marker-legend-background"> <span ng-repeat="c in colours"> <div layout="row"> <div style="background-color: {{c.colour}}" class="marker-legend-item"></div> <div>{{c.label}}</div> </div> </span> </div>'),a.put("views/plotly-bar-chart.html",""),a.put("views/resource-renderer.html",'<div layout="column"> <md-list-item ng-click="toggleItem()"> {{title}} ({{resources.length}}) </md-list-item> <span ng-hide="config.hide"> <md-divider></md-divider> <search-resources resources="resources" search-results="searchResults"></search-resources> <div layout="column"> <ol class="no-margin" start="{{config.numberFrom}}"> <li ng-repeat="resource in resourceSet" class="md-padding"> <span> <span class="online_indicator" ng-if="resource.is_online">ONLINE</span> <span ng-bind-html="resource.text"></span> </span> <a href="" ng-click="moreInformation(resource.url)">{{resource.name}}</a> </li> </ol> </div> <div class="" layout="row" layout-align="center center" ng-if="enablePagination" flex> <md-button class="md-primary" ng-click="jumpToStart()"><i class="material-icons">fast_rewind</i></md-button> <md-button class="md-primary" ng-click="back()"><i class="material-icons">skip_previous</i></md-button> <md-button class="md-primary" ng-click="forward()"><i class="material-icons">skip_next</i></md-button> <md-button class="md-primary" ng-click="jumpToEnd()"><i class="material-icons">fast_forward</i></md-button> </div> <md-divider></md-divider> </span> </div>'),a.put("views/search-resources.html",'<div layout="row"> <md-input-container flex> <label>Filter the resources</label> <input type="text" ng-model="what" ng-change="search()"> </md-input-container> <md-button ng-click="reset()" class="md-primary">Reset</md-button> </div>')}]);